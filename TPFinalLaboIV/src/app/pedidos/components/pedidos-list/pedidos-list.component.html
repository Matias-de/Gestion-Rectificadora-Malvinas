<div class="filtros">
  <h3>Filtrar Pedidos</h3>

  <!-- Filtrar por estado -->
  <div class="filtro-estado">
    <button (click)="filtrarPorEstado('activo')">Estado: Activo</button>
    <button (click)="filtrarPorEstado('entregado')">Estado: Entregado</button>
    <button (click)="filtrarPorEstado('atrasado')">Estado: Atrasado</button>
  </div>

  <!-- Filtrar por rango de fecha de entrada -->
  <div class="filtro-fecha-contenedor">
    <label for="fechaInicio">Fecha de Entrada desde:</label>
    <input type="date" id="fechaInicio" [(ngModel)]="fechaInicio">
    
    <label for="fechaFin">hasta:</label>
    <input type="date" id="fechaFin" [(ngModel)]="fechaFin">
    
    <button (click)="filtrarPorFechaEntrada(fechaInicio, fechaFin)">Filtrar por Fecha</button>
  </div>
  <div class="filtro-cliente-contenedor">
    <input type="text" [(ngModel)]="clienteFiltro" placeholder="Buscar por apellido o nombre de cliente" class="filtro-cliente-input">
    <button (click)="filtrarPorCliente()" class="filtro-cliente-boton">Filtrar por Cliente</button>
  </div>

  <!-- Restablecer filtros -->
  <button class="reset-button" (click)="resetearFiltros()">Restablecer Filtros</button>
</div>

<div *ngIf="pedidosCercanos.length > 0" class="alerta-pedidos-cercanos">
  <p>⚠️ Hay {{ pedidosCercanos.length }} pedido(s) que están a punto de finalizar.</p>
</div>


<div class="pedido-lista">
  <h2 class="subtitulo-1">Lista de Pedidos</h2>
  <div class="pedido-datos">
@for (pedido of pedidosFiltrados; track $index) {
    <p>ID: {{ pedido.id }}</p>
    <p>Nombre: {{ pedido.cliente.nombre }}, Apellido: {{ pedido.cliente.apellido }}</p>
    <p>Fecha de Entrada: {{pedido.fechaEntrada | date: 'dd-MM-yyyy'}}</p>
    <p>Fecha De Salida Estimada: {{ pedido.fechaSalidaEstimada | date: 'dd-MM-yyyy' }}</p>   
    <p class="estado" [ngClass]="{
      'estado-activo': pedido.estado === 'activo',
      'estado-entregado': pedido.estado === 'entregado',
      'estado-atrasado': pedido.estado === 'atrasado'
    }">
      Estado: {{ pedido.estado }}
    </p>
    <p>Descripcion: {{pedido.descripcion}}</p>
    <div *ngIf="pedido.presupuesto">
      <h3>Presupuesto</h3>
      <p>ID del Presupuesto: {{pedido.presupuesto.id}}</p>
      <p>Fecha del Presupuesto: {{pedido.presupuesto.fecha | date}}</p>
      <p>Descuento: {{pedido.presupuesto.descuento}}%</p>
      
      <!-- Listado de Items del Presupuesto -->
      <h4>Items del Presupuesto:</h4>
      <ul>
        <li *ngFor="let item of pedido.presupuesto.items">
          <p>Nombre: {{item.nombre}}</p>
          <p>Descripción: {{item.descripcion}}</p>
          <p>Precio Unitario: {{item.precioUnitario | currency}}</p>
          <p>Precio Mano de Obra: {{item.precioManoObra | currency}}</p>
          <p>Precio Final: {{item.precioFinal | currency}}</p>
        </li>
      </ul>
    </div>
    <div class="botones">
      <button (click)="eliminarPedidos(pedido.id)" class="eliminar-btn">Eliminar</button>
      <button (click)="exportarPedidoPDF(pedido)" class="pdf-btn">Exportar PDF</button>
      <button (click)="confirmarEntrega(pedido)" class="entregar-btn">Entregar Pedido</button>
      <a [routerLink]="['update', pedido.id]" class="actualizar-btn">Actualizar</a>
    </div>
    <hr>
  }
  </div>
</div>